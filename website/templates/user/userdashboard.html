<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mushify-User-Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    </script>
    <style>
         body{
        color:white;
        
         }
         /* header{
          display: flex;
          align-items: center;
          justify-content: center;
          flex-direction: column;
         } */
         .hoverable-div{
        display: flex;
        align-items: center;
        position: relative;
        z-index: 1;
        width: 20%;
      }
      .hover-content{
        position: absolute;
        display: none;
        z-index: 1;
        background-color: rgba(0, 0, 0, 0.815);
      }
      .hoverable-div:hover .hover-content{
        display: flex;
        width: 20rem;
        padding: 2rem;
        font-size: small;
        align-items: center;
        flex-direction: column;
        justify-content: center;
        opacity: 1;
        z-index: 2;
        
      }
      .offfcnvas a, form{
        padding: 1rem;
      }
        
      ::-webkit-scrollbar {
            width: 0;
            height: 0;
        }

    
      
    </style>
</head>
<body class="" style="background: radial-gradient(circle, rgb(43, 40, 49) 2%, rgb(28, 28, 32) 62%, rgb(28, 28, 30) 87%);">
 
      
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark" >
        <div class="container-fluid bg-dark">
          
          <h4 type="button" class="mt-2" data-bs-toggle="offcanvas" data-bs-target="#offcanvasWithBothOptions" aria-controls="offcanvasWithBothOptions">Mushify</h4>
          
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0 bg-dark">
           
              
              <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="/">Home <i class="fas fa-solid fa-house"></i></a>
              </li>
              <!-- <li class="nav-item"><a class="nav-link" href="/discover">Discover</a></li> -->
              <li class="nav-item"><a class="nav-link" href="/logout">LogOut</a></li>
              <li class="nav-item"><a class="nav-link" href="/discover-songs">Discover Songs & Albums</a></li>
              <li class="nav-item"><a class="nav-link" href="/user/discovercreators">Discover Creators</a></li>
              
                  
                
                
            
            </ul>
            <!-- <div class="becomeacreator">
              <form action="/user/dashboard/paymentgateway" method="POST">
                <button type="submit" class="btn btn-outline-info" ><i class="fa-solid fa-plus" style="color: #188aa4;"> Become a creator</i></button>
          
              </form>
            </div> -->
          </div>
        </div>
    </nav>
    
      
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
        {% if category=='error' %}
        <div class="alert alert-danger alert-dismissable fade show" role="alert" id="errorAlert"> 
          {{ message}}
          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        {% else %}
        <div class="alert alert-success alert-dismissable fade show" role="alert" id="successAlert">
          {{ message}}
          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        {% endif %}
        {% endfor %}
    {% endif %}
    {% endwith %}
    
    
    <div class="body-container">
      <div class="header-container d-flex justify-content-around align-items-center mb-5">
        <h3 class="btn btn-outline-info mt-5" style="font-size: small;" data-bs-toggle="offcanvas" data-bs-target="#offcanvasWithBothOptions" aria-controls="offcanvasWithBothOptions"> Welcome {{username}}</h3>
        <!-- <a href="{{url_for('auth.createplaylist')}}" class="btn btn-outline-info mt-5" style="font-size: small;">Create Playlist</a> -->

      </div>
      


      

      <div class="offcanvas offcanvas-start bg-dark" data-bs-scroll="true" tabindex="-1" id="offcanvasWithBothOptions" aria-labelledby="offcanvasWithBothOptionsLabel">
        <div class="offcanvas-header">
          <h5 class="offcanvas-title " id="offcanvasWithBothOptionsLabel">User Profile and Settings</h5>
          <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body bg-dark">
          <ul class="border border-secondary d-flex flex-column align-items-start justify-content-around bg-dark p-5 offfcnvas">
            <a href="{{url_for('auth.createplaylist')}}"><li class="btn btn-outline-info">Create Playlists</li></a>
            <a href="/user/dashboard/change-details"><li class="btn btn-outline-info">Change User Details</li></a>
            <a href="{{url_for('auth.discoversongs')}}"><li class="btn btn-outline-info">Discover songs</li></a>
            <form action="/user/dashboard/paymentgateway" method="POST">
              <button type="submit" class="btn btn-outline-info" >Become a creator</button>
        
            </form>
            
          </ul>
          
        </div>
      </div>

      
     

   


    </div>
    <div class="maincont d-flex flex-column align-items-center justify-content-center mb-5">




      <div class="maincont1 d-flex flex-column align-items-center p-2 justify-content-center w-100">
        {% if songs %}
        <div class="head d-flex w-100 justify-content-around">
          <h1 class="fs-4 fw-semibold border border-secondary rounded-2 p-1 text-white">Songs You Might Like</h1>
          <a href="/discover-songs" class="fs-6 btn btn-outline-info p-2">see all</a>
        </div>
        {% endif %}

        <div {% if songs %} class="w-100 d-flex align-items-center justify-content-between p-5 gap-5 mb-3" style="overflow-x: auto;" {% else %} class="song-container w-100 d-flex align-items-center justify-content-center flex-wrap p-5 gap-2 mb-3" {% endif %}>
          
          {% if songs %}
             
            {% for song in songs %}
                <div class="d-flex align-items-center justify-content-center flex-wrap border rounded-5 p-5" style="box-shadow: black 2rem 1rem 1.5rem; background:linear-gradient(to bottom, rgb(52, 6, 21), rgb(190, 28, 82))">
                 
                    <div class="d-flex flex-column align-items-center justify-content-center">
                      <a href="{{ url_for('auth.fullscreen_view', song_id=song.id) }}">
                        <div class="overlay" style="font-size: 2rem; color: rgb(238, 66, 112)">
                          <i class="fas fa-duotone fa-circle-play fa-fade"></i>
                        </div>
                        <img src="{{ song.cover_image_path.split('/website')[1] }}" class="card-img-top border border-white image-fluid rounded-5" alt="{{song.name}}" style="width: 10rem; height: 10rem; box-shadow: black 1rem 0rem 2rem;">
                    </a>
                        
                       
                        <div class=" fw-bold border-bottom w-100 d-flex align-items-center justify-content-center text-break mt-3" style="font-size:smaller;">{{song.name}}</div>
                       
                        <!-- <div class="w-100 d-flex flex-column align-items-center justify-content-center">
                          <div class="audio w-100">
                            <audio controls loop class="m-2" style="width: 200px;">
                              <source src="{{ song.song_file_path.split('/website')[1] }}" type="audio/mpeg" class="">
                              Your browser does not support the audio element.
                              
                            </audio>
    
                          </div>
                          </div> -->
                        
                        <div class="rating-section d-flex align-items-center justify-content-center flex-column w-100 mt-3">
                          <div class="datacontainer d-flex w-100 align-items-center justify-content-center">
                            <h6 class="ms-2" style="color: #fc4475;">Likes : <span style="color: rgb(255, 255, 255);"> {{ song.likes }} Likes</span> </h4>
                            <p class=""></p>
                            <div class="hoverable-div w-25 d-flex flex-column align-items-center justify-content-center mb-2" id="hover-div">
                              <!-- <i class="fa-solid fa-circle-info" style="font-size:1rem;"></i> -->
                             
                              <div class="hover-content" id="info">
                                <div class="bg-gradient-secondary text-white fw-bold border-bottom">{{song.name}}</div>
                                <h8 class="fw-bold">{{song.artist}}</h8>
                                <h8 class="text-secondary fw-semibold d-block">uploaded by : {{song.creator_name}}</h8>
                                <h6 class="border-bottom">Lyrics</h6>
                                <h6 class="" style="font-size: x-small;">{{song.lyrics}}</h6>
          
                              </div>
          
                            </div>
    
                          </div>
                          
                      </div>
                    </div>
                </div>
    
    
          
                
             
                
    
    
    
                
            {% endfor %}
    
    
        {% else %}
            <div class="nosongfound" style="width: 80vw; display: flex; align-items: center; justify-content: center;"><h2 class="btn btn-secondary">No songs To Display</h2></div>
        {% endif %}
    
            </div>


      </div>
       {% if liked_song_ids %}<h2 class="fs-4 fw-semibold border border-secondary rounded-2 p-1 text-white">Previously Liked Songs</h2>{% endif %}


      <div class="previously d-flex align-items-center justify-content-start mb-2 w-100 p-5 gap-3" style="overflow-x: auto; background-color: transparent;">
        {% if allsongs %}
            {% for song in allsongs%}
            
            {% if song.id in liked_song_ids %}
            
            <div class="d-flex align-items-center justify-content-center flex-wrap bg-dark border rounded-5 p-5" style="box-shadow: black 1rem 1rem 1rem; background:linear-gradient(to bottom, rgb(6, 40, 52), rgb(11, 160, 193))">
                 
              <div class="p-3 d-flex flex-column align-items-center justify-content-center">
                  
                <a href="{{ url_for('auth.fullscreen_view', song_id=song.id) }}">
                  <div class="overlay" style="font-size: 2rem; color: rgb(229, 16, 87);">
                    <i class="fas fa-duotone fa-circle-play fa-fade"></i>
                  </div>
                  <img src="{{ song.cover_image_path.split('/website')[1] }}" class="card-img-top border border-white image-fluid rounded-5" alt="{{song.name}}" style="width: 10rem; height: 10rem; box-shadow: black 1rem 0rem 2rem;">
                  
              </a>
                  <div class=" fw-bold border-bottom w-100 d-flex align-items-center justify-content-center text-break mt-3" style="font-size:smaller;">{{song.name}}</div>
                  <p class="btn mt-2 fw-semibold">Likes: <span class="text-danger">{{song.likes}} likes</span></p>
              </div>
          </div>
          {% endif %}
          {% endfor %}
          {% endif %}
      </div>
    
        


    
        <div class="maincont2 d-flex flex-column align-items-center justify-content-center w-100">
          <div class="d-flex align-items-center flex-column justify-content-center w-100">

            {% if playlists %}
                {% if playlists.all()|length > 0 %}
                <h2 class="fs-4 fw-semibold border border-secondary rounded-2 p-2 btn btn-secondary bg-dark text-white">Created Playlists</h2>
                {% endif %}
                <div class="d-flex align-items-center justify-content-start gap-2 mt-2 p-2" style="overflow-x: auto; width: 98%;">
                  
              
                  
                  {% for playlist in playlists %}
                  <div class="d-flex align-items-center justify-content-around gap-2 rounded-5" style="background-color: rgb(21, 21, 21); box-shadow: black 0.5rem 0.5rem 1.5rem;">
                    <div class="p-5 d-flex flex-column align-items-center justify-content-center">
                      <div class="d-flex align-items-center justify-content-around flex-row">
                          <h5 class="btn btn-outline-success">{{ playlist.name }}</h5>
                          <select class="form-select btn btn-secondary" id="playlist_{{ playlist.id }}">
                              <!-- <option value="" selected>Select a song</option> -->
                              {% if playlist.songs %}
                                {% for song in playlist.songs %}
                                    <option value="{{ song.song_file_path.split('/website')[1] }}">{{ song.name }}</option>
                                {% endfor %}
      
                              {% else %}
                                  <option value="">No songs added to playlist</option>
                              {% endif %}
                          </select>
                        </div>
                          <button class="btn btn-primary play-song">Play</button>
                          <form method="POST" action="{{ url_for('auth.delete_playlist', playlist_id=playlist.id) }}" class="delete-form">
                            <button type="submit" class="btn btn-danger delete-playlist">Delete</button>
                          </form>
                      
                  </div>
      
                </div>
                      
                      
                  {% endfor %}
            
      
                  
              
                  {% else %}
                <h2 class="btn btn-secondary fs-4">No playlists found</h2>
                  {% endif %}
                    </div>

            
      
          </div>
              
            
        </div>
        



      </div>
      <div class="Artistsyoufollow maincont2 w-100 d-flex flex-column align-items-center justify-content-center mt-5">
        {% if user.followed_artists.all()|length > 0 %}
        <h1 class="border-bottom fs-2">Artist You Follow</h1>
        {% endif %}
        <div class="profilearea d-flex align-items-center justify-content-start w-100 gap-5 p-5" style="overflow-x: auto;">
          {% for artist in user.followed_artists %}
          <div class="cardartist bg-dark p-5">
          <div class="image-fluid card-img-top d-flex flex-row align-items-center justify-content-start">
            {% if artist.profile_image_path %}
              <img src="{{ artist.profile_image_path.split('/website')[1] }}" alt="" class="rounded-3" style="width: 200px; height: 200px; border: 2px solid white; box-shadow: black 1rem 0rem 3rem;">
              {% else %}
              <div class="border border-secondary d-flex align-items-center justify-content-center p-5" style="width: 200px;">
                <i class="fa-solid fa-user fs-2" style="color: #ffffff;"></i>
      
              </div>
              
              {% endif %}
      
              
      
          </div>
          <div class="card-body w-100 mt-3">
            <h5 class="text-white">{{artist.creator_name}}</h5>
            <a href="{{ url_for('auth.profilepage', user_id=artist.id) }}"><button class="btn btn-outline-info">view profile</button></a>
      
      
          </div>
          
      
          </div>
          
          {% endfor %}
          
        </div>
        {% if not user.followed_artists %}
          <p class="btn btn-secondary">No Creators</p>
        {% endif %}
      
      </div>
  
  
  
  
  





    

</body>








<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js" integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V" crossorigin="anonymous"></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
      const audioElements = document.querySelectorAll('audio');
      
      audioElements.forEach(function (audio) {
          audio.addEventListener('play', function () {
              // Pause all other audio elements
              audioElements.forEach(function (otherAudio) {
                  if (otherAudio !== audio && !otherAudio.paused) {
                      otherAudio.pause();
                  }
              });
          });
      });
  });
</script>
<script>
const audioElements = {};

// Function to play a song
function playSong(playlistId, selectedSongData) {
    if (audioElements[playlistId]) {
        // If an audio element already exists, stop and remove it
        audioElements[playlistId].pause();
        delete audioElements[playlistId];
    }

    // Create a new audio element
    const audioElement = new Audio();
    audioElement.src = `${selectedSongData}`;
    audioElement.play();
    audioElements[playlistId] = audioElement;
}

// Function to pause a song
function pauseSong(playlistId) {
    if (audioElements[playlistId]) {
        audioElements[playlistId].pause();
    }
}

// Function to handle the "Play/Pause" button click
function handlePlayButtonClick(button) {
    const playlistId = button.parentElement.querySelector('select').id;
    const selectedSongData = button.parentElement.querySelector('select').value;

    if (selectedSongData) {
        if (!audioElements[playlistId] || audioElements[playlistId].paused) {
            // Play the song if it's not playing or paused
            playSong(playlistId, selectedSongData);
            button.innerText = 'Pause';
        } else {
            // Pause the song if it's currently playing
            pauseSong(playlistId);
            button.innerText = 'Play';
        }
    }
}

// Attach click event listeners to all "Play" buttons
document.querySelectorAll('.play-song').forEach(function (button) {
    button.addEventListener('click', function () {
        handlePlayButtonClick(this);
    });
});

</script>

</html>